{"ast":null,"code":"// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { __extends } from \"tslib\";\nimport { HttpHeaders } from \"../httpHeaders\";\nimport { Constants } from \"../util/constants\";\nimport { getDefaultUserAgentKey, getPlatformSpecificData } from \"./msRestUserAgentPolicy\";\nimport { BaseRequestPolicy } from \"./requestPolicy\";\nfunction getRuntimeInfo() {\n  var msRestRuntime = {\n    key: \"ms-rest-js\",\n    value: Constants.msRestVersion\n  };\n  return [msRestRuntime];\n}\nfunction getUserAgentString(telemetryInfo, keySeparator, valueSeparator) {\n  if (keySeparator === void 0) {\n    keySeparator = \" \";\n  }\n  if (valueSeparator === void 0) {\n    valueSeparator = \"/\";\n  }\n  return telemetryInfo.map(function (info) {\n    var value = info.value ? \"\" + valueSeparator + info.value : \"\";\n    return \"\" + info.key + value;\n  }).join(keySeparator);\n}\nexport var getDefaultUserAgentHeaderName = getDefaultUserAgentKey;\nexport function getDefaultUserAgentValue() {\n  var runtimeInfo = getRuntimeInfo();\n  var platformSpecificData = getPlatformSpecificData();\n  var userAgent = getUserAgentString(runtimeInfo.concat(platformSpecificData));\n  return userAgent;\n}\nexport function userAgentPolicy(userAgentData) {\n  var key = !userAgentData || userAgentData.key == undefined ? getDefaultUserAgentKey() : userAgentData.key;\n  var value = !userAgentData || userAgentData.value == undefined ? getDefaultUserAgentValue() : userAgentData.value;\n  return {\n    create: function (nextPolicy, options) {\n      return new UserAgentPolicy(nextPolicy, options, key, value);\n    }\n  };\n}\nvar UserAgentPolicy = /** @class */function (_super) {\n  __extends(UserAgentPolicy, _super);\n  function UserAgentPolicy(_nextPolicy, _options, headerKey, headerValue) {\n    var _this = _super.call(this, _nextPolicy, _options) || this;\n    _this._nextPolicy = _nextPolicy;\n    _this._options = _options;\n    _this.headerKey = headerKey;\n    _this.headerValue = headerValue;\n    return _this;\n  }\n  UserAgentPolicy.prototype.sendRequest = function (request) {\n    this.addUserAgentHeader(request);\n    return this._nextPolicy.sendRequest(request);\n  };\n  UserAgentPolicy.prototype.addUserAgentHeader = function (request) {\n    if (!request.headers) {\n      request.headers = new HttpHeaders();\n    }\n    if (!request.headers.get(this.headerKey) && this.headerValue) {\n      request.headers.set(this.headerKey, this.headerValue);\n    }\n  };\n  return UserAgentPolicy;\n}(BaseRequestPolicy);\nexport { UserAgentPolicy };","map":{"version":3,"mappings":"AAAA;AACA;;AAEA,SAASA,WAAW,QAAQ,gBAAgB;AAE5C,SAASC,SAAS,QAAQ,mBAAmB;AAE7C,SAASC,sBAAsB,EAAEC,uBAAuB,QAAQ,yBAAyB;AACzF,SACEC,iBAAiB,QAIZ,iBAAiB;AAIxB,SAASC,cAAc;EACrB,IAAMC,aAAa,GAAG;IACpBC,GAAG,EAAE,YAAY;IACjBC,KAAK,EAAEP,SAAS,CAACQ;GAClB;EAED,OAAO,CAACH,aAAa,CAAC;AACxB;AAEA,SAASI,kBAAkB,CACzBC,aAA8B,EAC9BC,YAAkB,EAClBC,cAAoB;EADpB;IAAAD,kBAAkB;EAAA;EAClB;IAAAC,oBAAoB;EAAA;EAEpB,OAAOF,aAAa,CACjBG,GAAG,CAAC,UAACC,IAAI;IACR,IAAMP,KAAK,GAAGO,IAAI,CAACP,KAAK,GAAG,KAAGK,cAAc,GAAGE,IAAI,CAACP,KAAO,GAAG,EAAE;IAChE,OAAO,KAAGO,IAAI,CAACR,GAAG,GAAGC,KAAO;EAC9B,CAAC,CAAC,CACDQ,IAAI,CAACJ,YAAY,CAAC;AACvB;AAEA,OAAO,IAAMK,6BAA6B,GAAGf,sBAAsB;AAEnE,OAAM,SAAUgB,wBAAwB;EACtC,IAAMC,WAAW,GAAGd,cAAc,EAAE;EACpC,IAAMe,oBAAoB,GAAGjB,uBAAuB,EAAE;EACtD,IAAMkB,SAAS,GAAGX,kBAAkB,CAACS,WAAW,CAACG,MAAM,CAACF,oBAAoB,CAAC,CAAC;EAC9E,OAAOC,SAAS;AAClB;AAEA,OAAM,SAAUE,eAAe,CAACC,aAA6B;EAC3D,IAAMjB,GAAG,GACP,CAACiB,aAAa,IAAIA,aAAa,CAACjB,GAAG,IAAIkB,SAAS,GAAGvB,sBAAsB,EAAE,GAAGsB,aAAa,CAACjB,GAAG;EACjG,IAAMC,KAAK,GACT,CAACgB,aAAa,IAAIA,aAAa,CAAChB,KAAK,IAAIiB,SAAS,GAC9CP,wBAAwB,EAAE,GAC1BM,aAAa,CAAChB,KAAK;EAEzB,OAAO;IACLkB,MAAM,EAAE,UAACC,UAAyB,EAAEC,OAAiC;MACnE,OAAO,IAAIC,eAAe,CAACF,UAAU,EAAEC,OAAO,EAAErB,GAAG,EAAEC,KAAK,CAAC;IAC7D;GACD;AACH;AAEA;EAAqCsB;EACnC,yBACWC,WAA0B,EAC1BC,QAAkC,EACjCC,SAAiB,EACjBC,WAAmB;IAJ/B,YAMEC,kBAAMJ,WAAW,EAAEC,QAAQ,CAAC;IALnBI,iBAAW,GAAXL,WAAW;IACXK,cAAQ,GAARJ,QAAQ;IACPI,eAAS,GAATH,SAAS;IACTG,iBAAW,GAAXF,WAAW;;EAGvB;EAEAL,qCAAW,GAAX,UAAYQ,OAAwB;IAClC,IAAI,CAACC,kBAAkB,CAACD,OAAO,CAAC;IAChC,OAAO,IAAI,CAACN,WAAW,CAACQ,WAAW,CAACF,OAAO,CAAC;EAC9C,CAAC;EAEDR,4CAAkB,GAAlB,UAAmBQ,OAAwB;IACzC,IAAI,CAACA,OAAO,CAACG,OAAO,EAAE;MACpBH,OAAO,CAACG,OAAO,GAAG,IAAIxC,WAAW,EAAE;;IAGrC,IAAI,CAACqC,OAAO,CAACG,OAAO,CAACC,GAAG,CAAC,IAAI,CAACR,SAAS,CAAC,IAAI,IAAI,CAACC,WAAW,EAAE;MAC5DG,OAAO,CAACG,OAAO,CAACE,GAAG,CAAC,IAAI,CAACT,SAAS,EAAE,IAAI,CAACC,WAAW,CAAC;;EAEzD,CAAC;EACH,sBAAC;AAAD,CAAC,CAxBoC9B,iBAAiB","names":["HttpHeaders","Constants","getDefaultUserAgentKey","getPlatformSpecificData","BaseRequestPolicy","getRuntimeInfo","msRestRuntime","key","value","msRestVersion","getUserAgentString","telemetryInfo","keySeparator","valueSeparator","map","info","join","getDefaultUserAgentHeaderName","getDefaultUserAgentValue","runtimeInfo","platformSpecificData","userAgent","concat","userAgentPolicy","userAgentData","undefined","create","nextPolicy","options","UserAgentPolicy","__extends","_nextPolicy","_options","headerKey","headerValue","_super","_this","request","addUserAgentHeader","sendRequest","headers","get","set"],"sources":["C:\\Users\\willi\\Downloads\\azure-main\\node_modules\\@azure\\ms-rest-js\\lib\\policies\\userAgentPolicy.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\n\nimport { HttpHeaders } from \"../httpHeaders\";\nimport { HttpOperationResponse } from \"../httpOperationResponse\";\nimport { Constants } from \"../util/constants\";\nimport { WebResourceLike } from \"../webResource\";\nimport { getDefaultUserAgentKey, getPlatformSpecificData } from \"./msRestUserAgentPolicy\";\nimport {\n  BaseRequestPolicy,\n  RequestPolicy,\n  RequestPolicyFactory,\n  RequestPolicyOptionsLike,\n} from \"./requestPolicy\";\n\nexport type TelemetryInfo = { key?: string; value?: string };\n\nfunction getRuntimeInfo(): TelemetryInfo[] {\n  const msRestRuntime = {\n    key: \"ms-rest-js\",\n    value: Constants.msRestVersion,\n  };\n\n  return [msRestRuntime];\n}\n\nfunction getUserAgentString(\n  telemetryInfo: TelemetryInfo[],\n  keySeparator = \" \",\n  valueSeparator = \"/\"\n): string {\n  return telemetryInfo\n    .map((info) => {\n      const value = info.value ? `${valueSeparator}${info.value}` : \"\";\n      return `${info.key}${value}`;\n    })\n    .join(keySeparator);\n}\n\nexport const getDefaultUserAgentHeaderName = getDefaultUserAgentKey;\n\nexport function getDefaultUserAgentValue(): string {\n  const runtimeInfo = getRuntimeInfo();\n  const platformSpecificData = getPlatformSpecificData();\n  const userAgent = getUserAgentString(runtimeInfo.concat(platformSpecificData));\n  return userAgent;\n}\n\nexport function userAgentPolicy(userAgentData?: TelemetryInfo): RequestPolicyFactory {\n  const key: string =\n    !userAgentData || userAgentData.key == undefined ? getDefaultUserAgentKey() : userAgentData.key;\n  const value: string =\n    !userAgentData || userAgentData.value == undefined\n      ? getDefaultUserAgentValue()\n      : userAgentData.value;\n\n  return {\n    create: (nextPolicy: RequestPolicy, options: RequestPolicyOptionsLike) => {\n      return new UserAgentPolicy(nextPolicy, options, key, value);\n    },\n  };\n}\n\nexport class UserAgentPolicy extends BaseRequestPolicy {\n  constructor(\n    readonly _nextPolicy: RequestPolicy,\n    readonly _options: RequestPolicyOptionsLike,\n    protected headerKey: string,\n    protected headerValue: string\n  ) {\n    super(_nextPolicy, _options);\n  }\n\n  sendRequest(request: WebResourceLike): Promise<HttpOperationResponse> {\n    this.addUserAgentHeader(request);\n    return this._nextPolicy.sendRequest(request);\n  }\n\n  addUserAgentHeader(request: WebResourceLike): void {\n    if (!request.headers) {\n      request.headers = new HttpHeaders();\n    }\n\n    if (!request.headers.get(this.headerKey) && this.headerValue) {\n      request.headers.set(this.headerKey, this.headerValue);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}